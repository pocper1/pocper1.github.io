---
title: Internet
permalink: /backend/internet/
tags:
    - backend
    - internet
---

## 概述

作為後端開發者，我們每天都在與網路打交道，但常常忽略了其底層的運作機制。理解網路的核心原理，不僅能幫助我們更好地進行系統設計和效能調優，還能在遇到問題時更從容地進行排錯。本文件旨在揭開網路的神秘面紗，講述一個數據包如何從用戶端到達伺服器並返回的完整旅程。

-   **適用場景**: 任何希望深入理解 Web 應用底層通訊原理的開發者。
-   **前提條件**: 了解程式設計基礎。
-   **預期結果**: 建立起對 TCP/IP 協議棧、DNS、HTTP 等核心網路概念的清晰認知。

---

## 網路協議分層模型

現代網路的設計基於分層的思想，最常用的是 **TCP/IP 模型**。每一層都專注於解決特定的問題，並為其上一層提供服務，同時隱藏下層的複雜細節。我們可以將其簡化為四個核心層次：

1.  **應用層 (Application Layer)**: 處理特定應用的協議，如網頁瀏覽、電子郵件。
2.  **傳輸層 (Transport Layer)**: 負責端到端 (end-to-end) 的數據傳輸，保證數據的可靠性或速度。
3.  **網路層 (Internet Layer)**: 負責數據包在網路中的定址和路由。
4.  **鏈路層 (Link Layer)**: 負責在物理上相連的節點之間傳輸數據。

想像一下寄一封信：

-   **應用層**: 你寫信的內容 (HTTP 請求)。
-   **傳輸層**: 你把信放進信封，寫上收件人和寄件人的門牌號 (TCP 端口號)。
-   **網路層**: 你在信封上寫下詳細的街道地址 (IP 地址)。
-   **鏈路層**: 郵局的卡車、飛機等負責實際的運輸 (乙太網、Wi-Fi)。

---

## 深入各層核心協議

### 1. 應用層：Web 應用的語言

-   **HTTP (Hypertext Transfer Protocol)**: 超文本傳輸協議，是 Web 的基石。

    -   它是一個**請求-回應**協議。客戶端發送請求，伺服器返回回應。
    -   **請求結構**: 方法 (Method: GET, POST)、路徑 (Path: /users/123)、標頭 (Headers)、內文 (Body)。
    -   **回應結構**: 狀態碼 (Status Code: 200, 404)、標頭 (Headers)、內文 (Body)。
    -   **HTTPS**: 安全的 HTTP。透過 TLS/SSL 加密協議，確保數據在傳輸過程中的機密性和完整性。

-   **DNS (Domain Name System)**: 網域名稱系統，被稱為「網際網路的電話簿」。
    -   **作用**: 將人類易於記憶的網域名稱 (e.g., `google.com`) 解析為機器能夠識別的 IP 地址 (e.g., `142.250.207.14`)。
    -   如果沒有 DNS，我們上網就必須記住一長串無規律的數字。

### 2. 傳輸層：數據的快遞員

-   **TCP (Transmission Control Protocol)**: 傳輸控制協議，一個**可靠的**、**面向連接的**協議。

    -   **可靠性**: 透過「三次握手」建立連接，並透過序號、確認和重傳機制，保證數據**不丟失、不重複、按順序**到達。
    -   **適用場景**: 網頁瀏覽 (HTTP)、文件傳輸 (FTP)、電子郵件 (SMTP)。絕大多數 Web 應用都基於 TCP。

-   **UDP (User Datagram Protocol)**: 用戶數據報協議，一個**不可靠的**、**無連接的**協議。
    -   **不可靠性**: 它只負責盡力發送數據，不保證數據是否到達、是否按順序。就像寄平信，寄了就不管了。
    -   **優點**: 速度快、延遲低、系統開銷小。
    -   **適用場景**: 影片串流、線上遊戲、語音通話、DNS 查詢。這些場景對即時性要求高，可以容忍偶爾的丟包。

### 3. 網路層：全球路由系統

-   **IP (Internet Protocol)**: 網際網路協議，定義了網際網路的地址系統。
    -   **IP 地址**: 網絡中每台設備的唯一標識，分為 IPv4 和 IPv6。
    -   **數據包 (Packet)**: IP 協議將傳輸層的數據段 (Segment) 封裝成數據包，並在數據包頭部加上源和目的地的 IP 地址。
    -   **路由 (Routing)**: 路由器 (Router) 根據 IP 地址，決定數據包的下一步走向，最終將其從源頭送到目的地。

### 4. 鏈路層：物理高速公路

-   這是網路的物理基礎，包括乙太網 (Ethernet)、Wi-Fi、光纖等。
-   它負責將 IP 數據包轉換為電子信號或光信號在物理媒介上傳輸。
-   **MAC 地址**: 網卡設備的物理地址，在區域網路 (LAN) 內用於識別設備。

---

## 一個 Web 請求的完整旅程

讓我們將所有概念串聯起來，看看當你在瀏覽器中輸入 `https://google.com` 並按下 Enter 後，發生了什麼：

1.  **DNS 查詢**: 瀏覽器向本地 DNS 伺服器發起查詢，請求 `google.com` 的 IP 地址。

2.  **TCP 連接**: 瀏覽器獲得 IP 地址後，向該地址的 443 端口（HTTPS 預設端口）發起 TCP 連接請求，進行「三次握手」。

3.  **TLS 加密**: TCP 連接建立後，瀏覽器和伺服器進行 TLS 握手，協商加密算法，建立一條安全的加密通道。

4.  **HTTP 請求**: 瀏覽器透過加密通道，向伺服器發送一個 HTTP GET 請求，請求網站首頁的內容。

5.  **數據封裝**: 該 HTTP 請求數據在傳輸層被 TCP 協議分割成多個數據段，並在網路層被 IP 協議封裝成數據包。

6.  **數據傳輸**: 這些數據包經過你的電腦網卡、家用路由器、ISP 服務商的網路、以及網際網路中的無數個路由器，最終到達 Google 的伺服器。

7.  **伺服器處理**: Google 伺服器接收到數據包，按相反的順序（鏈路層 → 網路層 → 傳輸層 → 應用層）解開數據包，還原出完整的 HTTP 請求。Web 伺服器（如 Nginx）處理該請求，並準備好要返回的 HTML 頁面。

8.  **HTTP 回應**: 伺服器將 HTML 內容作為 HTTP 回應的內文，沿著剛剛建立的 TCP 通道發回給你的瀏覽器。

9.  **頁面渲染**: 瀏覽器接收到 HTTP 回應後，開始解析 HTML。如果 HTML 中包含其他資源（如 CSS、JavaScript、圖片），瀏覽器會重複上述過程，為每個資源發起新的 HTTP 請求，直到整個頁面被完整地渲染出來。

---

## 相關資源

-   [MDN Web Docs: How the Web works](https://developer.mozilla.org/en-US/docs/Learn/Common_questions/How_does_the_Web_work)
-   [An Illustrated Guide to the TPC/IP Model](https://www.youtube.com/watch?v=n3aEA_a2m3A)
