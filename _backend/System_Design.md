---
title: System Design
layout: collection
permalink: /backend/system_design/
collection: backend
category: backend
tags:
  - backend
  - system_design
---

## 核心概念

系統設計是一門藝術，旨在定義一個滿足特定業務需求的系統的架構、模組、介面和數據。它不僅僅是技術的堆疊，更是權衡 (Trade-off) 的藝術。好的系統設計能夠在效能、成本、可靠性和可擴展性之間找到最佳平衡。

## 系統設計的黃金原則

1.  **釐清需求與約束 (Clarify Requirements & Constraints):**
    *   **功能性需求:** 系統需要做什麼？（例如：用戶可以上傳影片、發布評論）
    *   **非功能性需求:** 系統需要達到什麼標準？（例如：99.99% 的可用性、低於 200ms 的響應時間、支持 100 萬日活躍用戶）
    *   **約束:** 有哪些限制？（例如：開發時間、團隊規模、技術棧偏好）

2.  **從高層次開始 (High-Level Design):**
    *   繪製系統的主要組件和它們之間的關係。
    *   識別單點故障 (Single Points of Failure)。
    *   定義各組件的職責。

3.  **深入細節 (Detailed Design):**
    *   為每個組件選擇合適的技術（例如：資料庫類型、緩存策略、API 協議）。
    *   設計數據模型 (Data Schema)。
    *   估算系統容量 (Capacity Estimation)。

## 關鍵組件與模式

| 組件/模式 | 解決的問題 | 核心原理 |
| --- | --- | --- |
| **負載均衡 (Load Balancer)** | 將流量均勻分配到多個伺服器，避免單點過載，提高可用性。 | L4 (傳輸層) vs. L7 (應用層) 負載均衡，採用輪詢、最少連接等算法。 |
| **資料庫 (Database)** | 持久化存儲和檢索數據。 | **SQL vs. NoSQL:** 關聯式資料庫保證 ACID，適合結構化數據；NoSQL 則提供高擴展性和靈活性，適合非結構化或半結構化數據。 |
| **緩存 (Cache)** | 暫存常用數據，減少對後端服務的請求，降低延遲。 | **快取策略:** Cache-Aside, Read-Through, Write-Through, Write-Back。 |
| **API 閘道 (API Gateway)** | 作為所有客戶端請求的單一入口，處理認證、限流、監控等橫切關注點。 | 簡化客戶端與微服務架構的互動。 |
| **消息佇列 (Message Queue)** | 將耗時操作異步化，實現服務解耦，提高系統的響應能力和可靠性。 | 生產者-消費者模型，削峰填谷。 |
| **內容分發網絡 (CDN)** | 在地理上分散的伺服器上緩存靜態內容，讓用戶從最近的節點讀取，加速內容傳遞。 | 減少延遲，降低源伺服器負載。 |

## 設計流程範例：設計一個短網址服務

1.  **需求分析:**
    *   **功能:** 將長網址轉換為短網址；點擊短網址能重定向到原始長網址。
    *   **非功能:** 高可用、低延遲、可擴展。

2.  **高層設計:**
    *   `Client` -> `Load Balancer` -> `Web Servers` -> `Database`
    *   寫入操作 (產生短網址): `Web Server` 產生一個唯一的短碼，與長網址一同存入資料庫。
    *   讀取操作 (重定向): `Web Server` 根據短碼查詢資料庫，找到對應的長網址，返回 301/302 重定向。

3.  **細節設計與權衡:**
    *   **短碼如何產生？**
        *   方案 A: 使用 Hash 函數 (如 MD5) 再取前 6 位。可能碰撞。
        *   方案 B: 使用一個全局計數器，轉換為 Base62 編碼。需要一個分佈式計數器服務。
    *   **資料庫選擇？**
        *   使用 NoSQL (如 DynamoDB, Cassandra) 的 Key-Value 存儲，以短碼為 Key，長網址為 Value。讀寫效能極高。
    *   **如何優化？**
        *   在 Web Server 和 Database 之間加入一層 Cache (如 Redis)，緩存熱門的短網址映射，大幅降低讀取延遲。

## 總結

系統設計是一個迭代的過程，沒有完美的答案，只有最適合當前場景的設計。關鍵在於理解各種技術的優劣，並在不同的約束條件下做出明智的權衡。