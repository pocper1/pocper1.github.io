---
title: API
permalink: /backend/api/
tags:
  - backend
  - api
---

## 1. Introduction to APIs (API 基礎介紹)

### 核心概念

**API Definition (API 定義)**

-   API (Application Programming Interface) 是軟體組件之間溝通的介面
-   定義了不同系統如何交換資料和功能
-   是軟體開發中實現模組化和重用性的關鍵

**API Types (API 類型)**

-   **Public API**: 對外開放，供第三方開發者使用
-   **Private API**: 組織內部使用，不對外公開
-   **Partner API**: 特定合作夥伴使用，需要授權

### 學習重點

-   理解 API 在現代軟體架構中的角色
-   掌握不同 API 類型的使用場景
-   了解 API 如何促進系統間的協作

---

## 2. API Terminologies (API 術語)

### HTTP 基礎概念

**HTTP Versions (HTTP 版本)**

-   HTTP/1.1: 傳統版本，文字協定
-   HTTP/2: 二進制協定，支援多路復用
-   HTTP/3: 基於 QUIC，更快的連線建立

**HTTP Methods (HTTP 方法)**

-   GET: 獲取資源
-   POST: 創建新資源
-   PUT: 更新/替換資源
-   DELETE: 刪除資源
-   PATCH: 部分更新資源

**HTTP Status Codes (HTTP 狀態碼)**

-   2xx: 成功 (200 OK, 201 Created)
-   3xx: 重定向 (301 Moved Permanently)
-   4xx: 客戶端錯誤 (400 Bad Request, 404 Not Found)
-   5xx: 伺服器錯誤 (500 Internal Server Error)

**Cookies & Caching (Cookie 和快取)**

-   Cookies: 儲存客戶端狀態資訊
-   Caching: 提高效能，減少伺服器負載

### 學習重點

-   掌握 HTTP 協定的核心概念
-   理解不同 HTTP 方法的語意
-   熟悉常見狀態碼的含義

---

## 3. API Styles (API 風格)

### 主要 API 架構風格

**REST (Representational State Transfer)**

-   基於資源的架構
-   使用標準 HTTP 方法
-   無狀態通訊
-   統一介面

**GraphQL**

-   查詢語言和執行引擎
-   客戶端決定需要的資料
-   單一端點
-   強型別系統

**SOAP (Simple Object Access Protocol)**

-   基於 XML 的協定
-   嚴格的標準和規範
-   內建錯誤處理
-   適合企業級應用

**WebSocket**

-   全雙工通訊協定
-   持續連線
-   即時資料傳輸
-   適合即時應用

### 學習重點

-   了解各種 API 風格的特點
-   掌握何時選擇哪種風格
-   理解每種風格的優缺點

---

## 4. API Authentication (API 認證)

### 常見認證方式

**Basic Auth (基本認證)**

-   使用用戶名和密碼
-   Base64 編碼
-   簡單但安全性較低

**Token-based Auth (令牌認證)**

-   使用訪問令牌
-   可設定過期時間
-   更安全的選擇

**JWT (JSON Web Token)**

-   自包含的令牌
-   數位簽章驗證
-   無狀態認證

**OAuth (開放授權)**

-   第三方授權框架
-   委託授權模式
-   廣泛用於社交登入

**Session Auth (會話認證)**

-   基於伺服器端會話
-   使用 Session ID
-   有狀態認證

### 學習重點

-   理解不同認證方式的原理
-   掌握各種認證的適用場景
-   了解安全性考量

---

## 5. API Documentation (API 文件)

### 文件工具和標準

**Swagger/OpenAPI**

Swagger 是一套用於設計、建構、記錄和使用 RESTful Web 服務的開源軟體框架。2016 年，Swagger 規範被捐贈給 OpenAPI Initiative，並重新命名為 OpenAPI Specification（OAS）。這是目前最廣泛採用的 API 描述標準。

OpenAPI 規範使用 YAML 或 JSON 格式來描述 API 的結構，包括端點、請求/回應格式、認證方式、錯誤碼等。規範描述了 API 的每個細節：路徑參數、查詢參數、請求主體、回應狀態碼、資料模型等。這種標準化的描述使得工具可以自動生成互動式文件、客戶端 SDK、伺服器存根等。

Swagger UI 是基於 OpenAPI 規範的互動式文件生成器，允許開發者直接在瀏覽器中測試 API。Swagger Codegen 可以從 OpenAPI 規範自動生成多種語言的客戶端程式庫和伺服器存根。

**Postman**

Postman 最初是一個簡單的 Chrome 擴充功能，現在已發展成為全功能的 API 開發和測試平台。它提供了直觀的圖形化介面來發送 HTTP 請求、檢視回應、管理環境變數、編寫測試腳本等。

Postman 的核心功能包括：請求建構器（支援各種 HTTP 方法和認證方式）、環境管理（可切換不同的開發、測試、生產環境）、測試腳本（使用 JavaScript 編寫自動化測試）、Mock 服務器（在實際 API 開發完成前提供模擬回應）。Postman Collections 允許將相關的 API 請求組織在一起，便於分享和協作。

Postman 還支援 API 文件生成，可以從 Collections 自動生成美觀的 API 文件，並支援協作功能讓團隊成員共同維護 API 規範。

**OpenAPI Spec**

OpenAPI Specification 是描述 RESTful API 的標準格式，提供了機器可讀的 API 合約。一個完整的 OpenAPI 文件包含多個部分：基本資訊（版本、標題、描述）、伺服器資訊、路徑定義、組件定義（可重用的模式、參數、回應等）、安全定義。

規範支援複雜的資料類型定義，包括物件、陣列、基本類型等，並支援繼承和組合。安全定義部分可以描述各種認證機制，如 API Key、OAuth2、HTTP 基本認證等。OpenAPI 3.0 引入了回調（Callbacks）和連結（Links）等高級功能，使得 API 描述更加豐富。

工具生態系統的豐富是 OpenAPI 成功的關鍵因素。除了官方工具，還有大量第三方工具支援 OpenAPI，包括驗證器、編輯器、程式碼生成器、測試框架等。

**Redoc**

Redoc 是另一個流行的 OpenAPI 文件渲染器，專注於生成美觀、易讀的 API 文件。與 Swagger UI 相比，Redoc 更注重文件的閱讀體驗，提供了更清晰的資訊架構和更美觀的視覺設計。

Redoc 支援響應式設計，在不同螢幕尺寸上都能提供良好的閱讀體驗。它還支援深度連結、搜尋功能、程式碼範例生成等功能。Redoc 可以處理大型 API 規範，並提供高效能的渲染。

**DapperDox**

DapperDox 是一個開源的 API 文件生成和發布平台，支援 OpenAPI 規範。它提供了更多的客製化選項，允許開發者調整文件的外觀和結構。DapperDox 支援多種輸出格式，包括靜態網站、PDF 等。

### 學習重點

-   學會撰寫清晰的 API 文件
-   掌握文件工具的使用
-   理解文件在 API 開發中的重要性

---

## 6. API Features (API 功能特性)

### 核心功能詳解

一個設計良好的 API 不僅僅是提供數據，更應該具備一系列特性來保證其健壯性、易用性和可維護性。

**Pagination (分頁)**
當一個請求可能返回大量數據時，一次性將所有數據傳回客戶端會造成巨大的網絡負擔和延遲，甚至可能耗盡伺服器或客戶端的記憶體。分頁機制將龐大的數據集分割成一個個易於管理的「頁面」，客戶端可以逐頁獲取。常見的分頁方式包括：基於偏移量（Offset/Limit）和基於游標（Cursor-based）。前者實現簡單，但深度分頁時效能會下降；後者雖然稍顯複雜，但能提供高效且穩定的查詢效能，特別適合處理即時更新的數據流。

**Idempotency (冪等性)**
冪等性是分散式系統中一個至關重要的概念，它保證同一個操作無論執行一次還是多次，其產生的結果都是相同的。在充滿不確定性的網路環境中，客戶端可能會因為超時或網路錯誤而重試請求。如果一個非冪等的操作（例如「創建訂單」）被重試，就可能導致重複創建多筆訂單。GET、PUT、DELETE 方法天然具備冪等性，而 POST 通常不具備。為了讓 POST 請求也實現冪等性，業界普遍採用 `Idempotency-Key` 請求標頭，讓客戶端生成一個唯一的密鑰，伺服器則根據此密鑰來識別和過濾重複的請求。

**HATEOAS (Hypermedia as the Engine of Application State)**
HATEOAS 是 REST 架構風格的核心約束之一，主張 API 的回應應該包含「超媒體連結」，用以指引客戶端接下來可以執行哪些操作。換句話說，客戶端不需要寫死（hardcode）API 的 URL 路徑，而是可以透過解析回應中的連結來「發現」和導航至下一個狀態或相關資源。這種設計使得 API 更加自描述，極大地降低了客戶端與伺服器之間的耦合度，讓 API 的演進和維護變得更加靈活。

**API Versioning (API 版本控制)**
隨著業務的發展，API 不可避免地需要更新和演進。當引入「破壞性變更」（Breaking Change）時，如果直接修改現有 API，將會導致所有正在使用它的舊版客戶端應用程式失靈。版本控制機制允許新舊版本的 API 共存，為客戶端提供了平滑的過渡期。常見的版本標識方式包括：在 URL 路徑中加入版本號（如 `/v1/users`）、使用自訂請求標頭（如 `Api-Version: 1`），或透過查詢參數（如 `?version=1`）。

**Content Negotiation (內容協商)**
內容協商機制允許同一個 URL 能夠根據客戶端的需求，回傳不同格式的資源表示。例如，一個客戶端可能需要 JSON 格式的數據，而另一個傳統系統可能需要 XML 格式。客戶端可以透過 `Accept` 請求標頭來聲明它能理解的內容類型，伺服器則根據此標頭來準備合適的回應，並在 `Content-Type` 回應標頭中註明其實際返回的格式。這提升了 API 的通用性和靈活性。

### 學習重點

-   理解這些特性如何提升 API 的品質、可靠性與使用者體驗。
-   掌握在真實世界場景中實作這些功能的最佳實踐與常見模式。
-   學會在 API 設計初期就將這些功能納入考量，以建立可持續演進的系統。

---

## 7. API Performance (API 效能)

### 效能優化策略詳解

API 的效能直接影響使用者體驗和系統的穩定性。一個緩慢或不穩定的 API 會迅速失去使用者的信任。因此，在設計和實作 API 時，必須系統性地考慮效能優化策略。

首先，為了應對高流量，**負載平衡 (Load Balancing)** 是不可或缺的一環。它能將傳入的請求智慧地分發到多台後端伺服器上，避免任何單一伺服器因不堪重負而崩潰，從而提高系統的整體可用性和處理能力。

在分散了請求之後，下一步是減少每台伺服器的工作量。**快取 (Caching)** 在此扮演了關鍵角色。透過將頻繁存取但不常變動的數據暫時儲存在高速記憶體中（如 Redis 或 Memcached），可以大幅減少對後端資料庫的直接存取，從而顯著降低回應延遲。

然而，僅有快取是不夠的，還需要保護 API 免於惡意攻擊或無心濫用。**速率限制 (Rate Limiting)** 機制透過限制單一使用者在特定時間內可以發起的請求次數，來確保資源的公平分配，防止系統被少數使用者拖垮。

當處理大量數據時，資料庫的查詢效率成為瓶頸。除了前述的 **分頁 (Pagination)** 機制來減少單次傳輸的數據量外，對資料庫進行合理的 **索引 (Indexing)** 也至關重要。索引能夠極大地加速數據的檢索速度，是優化讀取密集型 API 回應時間最有效的方法之一。

最後，隨著使用者數量的增長，整個系統必須具備擴展的能力。**擴展 (Scaling)** 分為垂直擴展（增強單一伺服器的性能）和水平擴展（增加更多伺服器）。在現代雲端架構中，基於微服務的水平擴展更具彈性和成本效益。所有這些優化策略的效果，都必須透過嚴謹的 **效能測試 (Performance Testing)**（如負載測試和壓力測試）來進行驗證和監控，以確保 API 在真實世界的壓力下依然表現出色。

### 學習重點

-   學會系統性地分析和識別 API 的效能瓶頸所在。
-   掌握快取、負載平衡、速率限制等多種效能優化技術的原理與應用場景。
-   理解效能、成本和系統複雜度之間的權衡關係，並做出合適的架構決策。

---

## 8. API Gateways (API 閘道)

### 主要 API 閘道解決方案

**AWS API Gateway**

-   Amazon 的完全託管服務
-   與 AWS 生態系統深度整合
-   自動擴展和高可用性

**Kong**

-   開源 API 閘道
-   豐富的插件生態系統
-   高效能和可擴展性

**Azure API Service**

-   Microsoft 的 API 管理平台
-   企業級功能
-   與 Azure 服務整合

**Apigee**

-   Google 的 API 管理平台
-   強大的分析和監控
-   企業級解決方案

**Nginx**

-   高效能 Web 伺服器和反向代理
-   可配置為 API 閘道
-   輕量級解決方案

### 為何需要 API 閘道？

在現代的微服務架構中，後端系統被拆分成許多小而獨立的服務。如果沒有統一的入口，客戶端（例如網頁或手機 App）就必須直接與數十甚至數百個微服務溝通。這不僅讓客戶端邏輯變得極為複雜，也意味著後端架構的任何變動都可能導致客戶端需要跟著修改，形成了一種脆弱的緊密耦合關係。

API 閘道的設計正是為了解決這個核心問題。它扮演著整個後端系統的「總管理員」與「單一門面」角色。所有來自客戶端的請求都會先抵達 API 閘道，再由它統一分派至對應的後端微服務。如此一來，客戶端無需再關心後端有多少服務、它們的網路位置在哪裡，從而實現了客戶端與後端架構的解耦。

更重要的是，許多功能，如使用者認證、權限控管、流量速率限制、日誌記錄與快取等，是大多數微服務都需要的共通需求。與其在每個微服務中重複實作這些「橫切關注點」（Cross-cutting concerns），不如將它們集中在 API 閘道上統一處理。這種設計讓微服務本身可以更專注於核心的業務邏輯，不僅簡化了開發與維護，也確保了整個系統安全策略與效能管理的一致性。此外，API 閘道還能扮演請求聚合的角色，將來自多個微服務的資料整合成單一回應，大幅優化了客戶端的請求效率。

### 學習重點

-   理解 API 閘道在微服務架構中的核心地位與價值。
-   掌握根據專案需求（如成本、規模、技術棧）選擇合適閘道解決方案的標準。
-   學習閘道的基礎配置，包括路由、安全策略和速率限制的設定。

---

## 9. API Implementation Frameworks (API 實作框架)

### 主要開發框架

**Flask (Python)**

-   輕量級 Web 框架，被稱為「微框架」。
-   核心簡單，但擴展性極強，允許開發者自由選擇工具和架構。
-   適合快速開發 API 原型和中小型專案。

**Node.js (JavaScript)**

-   基於 Chrome V8 引擎的 JavaScript 執行環境。
-   採用事件驅動和非阻塞 I/O 模型，特別適合處理大量並發請求。
-   擁有龐大的 npm 套件生態系統，開發效率高。

**Django (Python)**

-   功能完備的「全家桶」式 Web 框架。
-   內建 ORM、管理後台、認證系統等，開箱即用。
-   適合需要快速開發功能複雜、結構嚴謹的大型應用。

**Spring (Java)**

-   Java 生態中最成熟、最廣泛的企業級應用開發框架。
-   提供依賴注入、AOP 等強大功能，生態系統極其豐富。
-   適合構建大型、高效能、高可靠性的企業級後端服務。

**FastAPI (Python)**

-   現代、高效能的 Python API 框架。
-   基於 Starlette 和 Pydantic，自動支援異步操作並提供數據驗證。
-   最大的亮點是能根據 Python 的型別提示自動生成 OpenAPI 互動文件。

### 框架選擇考量

選擇 API 實作框架是一個涉及多方面權衡的決策。首先需要考慮的是 **效能需求**，不同的框架在處理速度和並發能力上存在差異，例如 Node.js 和 FastAPI 在這方面表現突出。同時，**開發速度** 也是一個關鍵因素，Django 和 Spring 這樣功能完備的框架雖然學習曲線較陡，但能透過內建模組加速複雜應用的開發。框架的 **生態系統** 成熟度決定了你能否輕易找到解決方案和第三方函式庫，這方面 Node.js 和 Spring 擁有巨大優勢。最後，也必須考量 **團隊技能** 的匹配度，選擇團隊最熟悉的技術棧，可以最大化開發效率並降低維護成本。

### 學習重點

-   深入了解至少一到兩個主流 API 框架的設計哲學與核心特性。
-   學習如何根據專案的具體需求（效能、開發週期、團隊背景）來進行技術選型。
-   理解框架並非萬能，重要的是掌握其背後的 Web 開發原理。

---

## 10. Integration Patterns (整合模式)

### 整合模式詳解

在複雜的系統中，各個服務或組件如何有效地溝通與協作，是架構設計的核心挑戰。整合模式為這些挑戰提供了經過驗證的解決方案。

最基礎的決策是在 **同步 (Sync) 與異步 (Async)** 之間做選擇。同步通訊如同打電話，請求方發出請求後必須等待回應，過程簡單直接，但如果後端處理耗時較長，就會造成請求方阻塞。異步通訊則像寄送電子郵件，請求方發送訊息後即可繼續處理其他事務，無需等待立即回應，這大大提升了系統的吞吐量和彈性。

在異步通訊中，**Webhooks** 是一種常見的事件通知機制。當特定事件（如「訂單已支付」）發生時，服務方會主動向預先訂閱的客戶端 URL 發送一個 HTTP 回調請求。這遠比讓客戶端不斷 **輪詢 (Polling)** 來檢查狀態變更要高效得多。

然而，當系統間的通訊流量巨大或需要更高的可靠性時，**訊息佇列 (Message Queue)** 成為更優越的選擇。它在服務之間引入了一個中介層，發送方將訊息放入佇列，接收方則從佇列中取出訊息進行處理。這種方式徹底解耦了服務之間的時空依賴，提供了削峰填谷、異步處理和失敗重試的能力，是構建大型分散式系統的基石。

對於非即時、數據量龐大的任務，例如生成月底報表，採用 **批次處理 (Batch Processing)** 模式更為合適。系統可以將一段時間內的數據收集起來，在伺服器負載較低時（如午夜）進行集中處理，以提高資源利用效率。

在當今主流的 **微服務 (Microservices)** 架構中，上述所有整合模式都會被綜合運用。而 **API 閘道 (API Gateway)** 則常被用作這些異構服務的統一入口，負責路由、聚合和安全控制，簡化了外部客戶端與內部複雜系統之間的互動。

### 學習重點

-   理解同步與異步通訊的根本差異及其對系統架構的影響。
-   掌握 Webhooks、輪詢和訊息佇列等模式的適用場景、優點與缺點。
-   學會在設計複雜系統時，如何組合運用多種整合模式來滿足不同的業務需求。

---

## 學習建議

### 實作練習

1. 從簡單的 REST API 開始
2. 逐步加入認證和授權
3. 實作效能優化技術
4. 嘗試不同的框架和工具

### 持續學習

-   關注 API 設計最佳實踐
-   學習新興技術和標準
-   參與開源專案
-   建立個人 API 專案集

### 實際應用

-   將學到的概念應用到實際專案
-   分析現有 API 的設計
-   參與 API 設計討論
-   建立自己的 API 標準

---

## 總結

這個學習路線圖提供了 API 開發的完整知識體系，從基礎概念到高級實作技術。重要的是要循序漸進，在實作中深化理解，並持續關注技術發展趨勢。
